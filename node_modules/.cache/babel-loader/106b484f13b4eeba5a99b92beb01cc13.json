{"ast":null,"code":"import _toConsumableArray from\"/Users/johncoakley/development/projects/release_partner/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/johncoakley/development/projects/release_partner/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/johncoakley/development/projects/release_partner/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/johncoakley/development/projects/release_partner/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useRef,useState,useEffect}from'react';// material-ui\nimport{Button,Dialog,useMediaQuery}from'@mui/material';// third-party\nimport _ from'lodash';import FullCalendar from'@fullcalendar/react';import listPlugin from'@fullcalendar/list';import dayGridPlugin from'@fullcalendar/daygrid';import timeGridPlugin from'@fullcalendar/timegrid';import timelinePlugin from'@fullcalendar/timeline';import interactionPlugin from'@fullcalendar/interaction';// project imports\nimport MainCard from'ui-component/cards/MainCard';import SubCard from'ui-component/cards/SubCard';import CalendarStyled from'./CalendarStyled';import Toolbar from'./Toolbar';import AddEventForm from'./AddEventForm';import axios from'utils/axios';// assets\nimport AddAlarmTwoToneIcon from'@mui/icons-material/AddAlarmTwoTone';// ==============================|| APPLICATION CALENDAR ||============================== //\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Calendar=function Calendar(){var calendarRef=useRef(null);var matchSm=useMediaQuery(function(theme){return theme.breakpoints.down('md');});// fetch events data\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),events=_useState2[0],setEvents=_useState2[1];var getEvents=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/calendar/events');case 2:response=_context.sent;setEvents(response.data.events);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getEvents(){return _ref.apply(this,arguments);};}();useEffect(function(){getEvents();},[]);var _useState3=useState(new Date()),_useState4=_slicedToArray(_useState3,2),date=_useState4[0],setDate=_useState4[1];var _useState5=useState(matchSm?'listWeek':'dayGridMonth'),_useState6=_slicedToArray(_useState5,2),view=_useState6[0],setView=_useState6[1];// calendar toolbar events\nvar handleDateToday=function handleDateToday(){var calendarEl=calendarRef.current;if(calendarEl){var calendarApi=calendarEl.getApi();calendarApi.today();setDate(calendarApi.getDate());}};var handleViewChange=function handleViewChange(newView){var calendarEl=calendarRef.current;if(calendarEl){var calendarApi=calendarEl.getApi();calendarApi.changeView(newView);setView(newView);}};var handleDatePrev=function handleDatePrev(){var calendarEl=calendarRef.current;if(calendarEl){var calendarApi=calendarEl.getApi();calendarApi.prev();setDate(calendarApi.getDate());}};var handleDateNext=function handleDateNext(){var calendarEl=calendarRef.current;if(calendarEl){var calendarApi=calendarEl.getApi();calendarApi.next();setDate(calendarApi.getDate());}};var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isModalOpen=_useState8[0],setIsModalOpen=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),selectedRange=_useState10[0],setSelectedRange=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),selectedEvent=_useState12[0],setSelectedEvent=_useState12[1];// calendar event select/add/edit/delete\nvar handleModalClose=function handleModalClose(){setIsModalOpen(false);setSelectedEvent(null);setSelectedRange(null);};var handleRangeSelect=function handleRangeSelect(arg){var calendarEl=calendarRef.current;if(calendarEl){var calendarApi=calendarEl.getApi();calendarApi.unselect();}setSelectedRange({start:arg.start,end:arg.end});setIsModalOpen(true);};var handleEventSelect=function handleEventSelect(arg){if(arg.event.id){var selectEvent=events.find(function(_event){return _event.id===arg.event.id;});setSelectedEvent(selectEvent);}else{setSelectedEvent(null);}setIsModalOpen(true);};var handleEventUpdate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref2){var event,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event=_ref2.event;_context2.prev=1;_context2.next=4;return axios.post('/api/calendar/events/update',{eventId:event.id,update:{allDay:event.allDay,start:event.start,end:event.end}});case 4:response=_context2.sent;setEvents(response.data.events);_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.error(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function handleEventUpdate(_x){return _ref3.apply(this,arguments);};}();var handleEventCreate=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.post('/api/calendar/events/new',data);case 2:response=_context3.sent;setEvents([].concat(_toConsumableArray(events),[response.data.event]));handleModalClose();case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function handleEventCreate(_x2){return _ref4.apply(this,arguments);};}();var handleUpdateEvent=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(eventId,update){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axios.post('/api/calendar/events/update',{eventId:eventId,update:update});case 2:response=_context4.sent;setEvents(response.data.events);handleModalClose();case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function handleUpdateEvent(_x3,_x4){return _ref5.apply(this,arguments);};}();var handleEventDelete=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(id){var newEvent;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return axios.post('/api/calendar/events/remove',{eventId:id});case 3:newEvent=_.reject(events,{id:id});setEvents(newEvent);handleModalClose();_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](0);console.error(_context5.t0);case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[0,8]]);}));return function handleEventDelete(_x5){return _ref6.apply(this,arguments);};}();var handleAddClick=function handleAddClick(){setIsModalOpen(true);};return/*#__PURE__*/_jsxs(MainCard,{title:\"Event Calendar\",secondary:/*#__PURE__*/_jsxs(Button,{color:\"secondary\",variant:\"contained\",onClick:handleAddClick,children:[/*#__PURE__*/_jsx(AddAlarmTwoToneIcon,{fontSize:\"small\",sx:{mr:0.75}}),\"Add New Event\"]}),children:[/*#__PURE__*/_jsxs(CalendarStyled,{children:[/*#__PURE__*/_jsx(Toolbar,{date:date,view:view,onClickNext:handleDateNext,onClickPrev:handleDatePrev,onClickToday:handleDateToday,onChangeView:handleViewChange}),/*#__PURE__*/_jsx(SubCard,{children:/*#__PURE__*/_jsx(FullCalendar,{weekends:true,editable:true,droppable:true,selectable:true,events:events,ref:calendarRef,rerenderDelay:10,initialDate:date,initialView:view,dayMaxEventRows:3,eventDisplay:\"block\",headerToolbar:false,allDayMaintainDuration:true,eventResizableFromStart:true,select:handleRangeSelect,eventDrop:handleEventUpdate,eventClick:handleEventSelect,eventResize:handleEventUpdate,height:matchSm?'auto':720,plugins:[listPlugin,dayGridPlugin,timelinePlugin,timeGridPlugin,interactionPlugin]})})]}),/*#__PURE__*/_jsx(Dialog,{maxWidth:\"sm\",fullWidth:true,onClose:handleModalClose,open:isModalOpen,sx:{'& .MuiDialog-paper':{p:0}},children:isModalOpen&&/*#__PURE__*/_jsx(AddEventForm,{event:selectedEvent,range:selectedRange,onCancel:handleModalClose,handleDelete:handleEventDelete,handleCreate:handleEventCreate,handleUpdate:handleUpdateEvent})})]});};export default Calendar;","map":{"version":3,"sources":["/Users/johncoakley/development/projects/release_partner/src/views/application/calendar/index.js"],"names":["useRef","useState","useEffect","Button","Dialog","useMediaQuery","_","FullCalendar","listPlugin","dayGridPlugin","timeGridPlugin","timelinePlugin","interactionPlugin","MainCard","SubCard","CalendarStyled","Toolbar","AddEventForm","axios","AddAlarmTwoToneIcon","Calendar","calendarRef","matchSm","theme","breakpoints","down","events","setEvents","getEvents","get","response","data","Date","date","setDate","view","setView","handleDateToday","calendarEl","current","calendarApi","getApi","today","getDate","handleViewChange","newView","changeView","handleDatePrev","prev","handleDateNext","next","isModalOpen","setIsModalOpen","selectedRange","setSelectedRange","selectedEvent","setSelectedEvent","handleModalClose","handleRangeSelect","arg","unselect","start","end","handleEventSelect","event","id","selectEvent","find","_event","handleEventUpdate","post","eventId","update","allDay","console","error","handleEventCreate","handleUpdateEvent","handleEventDelete","newEvent","reject","handleAddClick","mr","p"],"mappings":"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","sourcesContent":["import { useRef, useState, useEffect } from 'react';\r\n\r\n// material-ui\r\nimport { Button, Dialog, useMediaQuery } from '@mui/material';\r\n\r\n// third-party\r\nimport _ from 'lodash';\r\nimport FullCalendar from '@fullcalendar/react';\r\nimport listPlugin from '@fullcalendar/list';\r\nimport dayGridPlugin from '@fullcalendar/daygrid';\r\nimport timeGridPlugin from '@fullcalendar/timegrid';\r\nimport timelinePlugin from '@fullcalendar/timeline';\r\nimport interactionPlugin from '@fullcalendar/interaction';\r\n\r\n// project imports\r\nimport MainCard from 'ui-component/cards/MainCard';\r\nimport SubCard from 'ui-component/cards/SubCard';\r\nimport CalendarStyled from './CalendarStyled';\r\nimport Toolbar from './Toolbar';\r\nimport AddEventForm from './AddEventForm';\r\nimport axios from 'utils/axios';\r\n\r\n// assets\r\nimport AddAlarmTwoToneIcon from '@mui/icons-material/AddAlarmTwoTone';\r\n\r\n// ==============================|| APPLICATION CALENDAR ||============================== //\r\n\r\nconst Calendar = () => {\r\n    const calendarRef = useRef(null);\r\n    const matchSm = useMediaQuery((theme) => theme.breakpoints.down('md'));\r\n\r\n    // fetch events data\r\n    const [events, setEvents] = useState([]);\r\n    const getEvents = async () => {\r\n        const response = await axios.get('/api/calendar/events');\r\n        setEvents(response.data.events);\r\n    };\r\n\r\n    useEffect(() => {\r\n        getEvents();\r\n    }, []);\r\n\r\n    const [date, setDate] = useState(new Date());\r\n    const [view, setView] = useState(matchSm ? 'listWeek' : 'dayGridMonth');\r\n\r\n    // calendar toolbar events\r\n    const handleDateToday = () => {\r\n        const calendarEl = calendarRef.current;\r\n\r\n        if (calendarEl) {\r\n            const calendarApi = calendarEl.getApi();\r\n\r\n            calendarApi.today();\r\n            setDate(calendarApi.getDate());\r\n        }\r\n    };\r\n\r\n    const handleViewChange = (newView) => {\r\n        const calendarEl = calendarRef.current;\r\n\r\n        if (calendarEl) {\r\n            const calendarApi = calendarEl.getApi();\r\n\r\n            calendarApi.changeView(newView);\r\n            setView(newView);\r\n        }\r\n    };\r\n\r\n    const handleDatePrev = () => {\r\n        const calendarEl = calendarRef.current;\r\n\r\n        if (calendarEl) {\r\n            const calendarApi = calendarEl.getApi();\r\n\r\n            calendarApi.prev();\r\n            setDate(calendarApi.getDate());\r\n        }\r\n    };\r\n\r\n    const handleDateNext = () => {\r\n        const calendarEl = calendarRef.current;\r\n\r\n        if (calendarEl) {\r\n            const calendarApi = calendarEl.getApi();\r\n\r\n            calendarApi.next();\r\n            setDate(calendarApi.getDate());\r\n        }\r\n    };\r\n\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [selectedRange, setSelectedRange] = useState(null);\r\n    const [selectedEvent, setSelectedEvent] = useState(null);\r\n\r\n    // calendar event select/add/edit/delete\r\n    const handleModalClose = () => {\r\n        setIsModalOpen(false);\r\n        setSelectedEvent(null);\r\n        setSelectedRange(null);\r\n    };\r\n\r\n    const handleRangeSelect = (arg) => {\r\n        const calendarEl = calendarRef.current;\r\n        if (calendarEl) {\r\n            const calendarApi = calendarEl.getApi();\r\n            calendarApi.unselect();\r\n        }\r\n\r\n        setSelectedRange({\r\n            start: arg.start,\r\n            end: arg.end\r\n        });\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleEventSelect = (arg) => {\r\n        if (arg.event.id) {\r\n            const selectEvent = events.find((_event) => _event.id === arg.event.id);\r\n            setSelectedEvent(selectEvent);\r\n        } else {\r\n            setSelectedEvent(null);\r\n        }\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleEventUpdate = async ({ event }) => {\r\n        try {\r\n            const response = await axios.post('/api/calendar/events/update', {\r\n                eventId: event.id,\r\n                update: {\r\n                    allDay: event.allDay,\r\n                    start: event.start,\r\n                    end: event.end\r\n                }\r\n            });\r\n\r\n            setEvents(response.data.events);\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const handleEventCreate = async (data) => {\r\n        const response = await axios.post('/api/calendar/events/new', data);\r\n\r\n        setEvents([...events, response.data.event]);\r\n        handleModalClose();\r\n    };\r\n\r\n    const handleUpdateEvent = async (eventId, update) => {\r\n        const response = await axios.post('/api/calendar/events/update', {\r\n            eventId,\r\n            update\r\n        });\r\n\r\n        setEvents(response.data.events);\r\n        handleModalClose();\r\n    };\r\n\r\n    const handleEventDelete = async (id) => {\r\n        try {\r\n            await axios.post('/api/calendar/events/remove', {\r\n                eventId: id\r\n            });\r\n\r\n            const newEvent = _.reject(events, { id });\r\n            setEvents(newEvent);\r\n            handleModalClose();\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const handleAddClick = () => {\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    return (\r\n        <MainCard\r\n            title=\"Event Calendar\"\r\n            secondary={\r\n                <Button color=\"secondary\" variant=\"contained\" onClick={handleAddClick}>\r\n                    <AddAlarmTwoToneIcon fontSize=\"small\" sx={{ mr: 0.75 }} />\r\n                    Add New Event\r\n                </Button>\r\n            }\r\n        >\r\n            <CalendarStyled>\r\n                <Toolbar\r\n                    date={date}\r\n                    view={view}\r\n                    onClickNext={handleDateNext}\r\n                    onClickPrev={handleDatePrev}\r\n                    onClickToday={handleDateToday}\r\n                    onChangeView={handleViewChange}\r\n                />\r\n                <SubCard>\r\n                    <FullCalendar\r\n                        weekends\r\n                        editable\r\n                        droppable\r\n                        selectable\r\n                        events={events}\r\n                        ref={calendarRef}\r\n                        rerenderDelay={10}\r\n                        initialDate={date}\r\n                        initialView={view}\r\n                        dayMaxEventRows={3}\r\n                        eventDisplay=\"block\"\r\n                        headerToolbar={false}\r\n                        allDayMaintainDuration\r\n                        eventResizableFromStart\r\n                        select={handleRangeSelect}\r\n                        eventDrop={handleEventUpdate}\r\n                        eventClick={handleEventSelect}\r\n                        eventResize={handleEventUpdate}\r\n                        height={matchSm ? 'auto' : 720}\r\n                        plugins={[listPlugin, dayGridPlugin, timelinePlugin, timeGridPlugin, interactionPlugin]}\r\n                    />\r\n                </SubCard>\r\n            </CalendarStyled>\r\n\r\n            {/* Dialog renders its body even if not open */}\r\n            <Dialog maxWidth=\"sm\" fullWidth onClose={handleModalClose} open={isModalOpen} sx={{ '& .MuiDialog-paper': { p: 0 } }}>\r\n                {isModalOpen && (\r\n                    <AddEventForm\r\n                        event={selectedEvent}\r\n                        range={selectedRange}\r\n                        onCancel={handleModalClose}\r\n                        handleDelete={handleEventDelete}\r\n                        handleCreate={handleEventCreate}\r\n                        handleUpdate={handleUpdateEvent}\r\n                    />\r\n                )}\r\n            </Dialog>\r\n        </MainCard>\r\n    );\r\n};\r\n\r\nexport default Calendar;\r\n"]},"metadata":{},"sourceType":"module"}